"use strict";var myList,txtPhone,txtLatitude,txtLongitude,txtAddress,txtId,txtFullName,phoneNumberCleave,btnReloadShopingCartcartDetail,txtCode,txtDiscountcartDetail,txtDiscountCode,btnSubmitLoadDiscountCode,frmShipInfo,btnSearchWard,txtVnLocationName,txtVnLocationId,spanDataShipAddress,listLabelNeedPlaceId,btnComplete,btnShowSugestModel,btnLatLng,btnLoadLazyListVoucher,suggestLocationModel,vnLocationSuggestContainer,showListVoucherModel,userLocalStorage,isAuthenticated,privateNoVnLocationMessage="",forceComplete=!0,shipInfoResponses=null;function loadListVoucher(){var e;btnLoadLazyListVoucher.click(),showListVoucherModel.removeAttribute("hidden"),showListVoucherModel.classList.add("visible"),document.querySelector("#frmLazyLoadDiscountCodeList [name='payTypeEnum']").value=document.querySelector("[name='OrderViewModel.PayTypeEnum']:checked").value,null===(e=document.getElementById("btnSubmitLoadDiscountCodeList"))||void 0===e||e.click()}function initVoucher(e){var t=document.querySelector(e).querySelector("[data-generate-barcode]");t&&new QRCode(t,{text:t.dataset.generateBarcode,width:64,height:64,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L})}function selecVoucher(e){txtDiscountCode.value=e,Site.RefreshUnobtrusiveValidate("#frmShipInfo"),uploadCart(e),loadVoucher(e),Site.ClosePopup()}function processGetLatlongBtn(){btnLatLng&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){txtLatitude.value=e.coords.latitude,txtLongitude.value=e.coords.longitude,.5<WNumbHelper.GetDistance(userLocalStorage.Latitude,userLocalStorage.Longitude,e.coords.latitude,e.coords.longitude)&&(userLocalStorage.VnLocationId="",userLocalStorage.VnLocationName=""),userLocalStorage.Latitude=e.coords.latitude,userLocalStorage.Longitude=e.coords.longitude,LocalStorageHelper.Set(LocalStorageNamesEnum.UserConfigs,userLocalStorage),btnLatLng.classList.add("hide"),txtVnLocationId.value||AjaxRequest.SendRequestGetJson("POST","shopingcart/getvnlocationbyLatLng",{latitude:e.coords.latitude,longitude:e.coords.longitude},function(e,t){var o=JSON.parse(e);if(userLocalStorage&&""!==userLocalStorage.VnLocationId)selectedSuggestGeoLocation();else{var a=Site.HtmlToElement("<li class='row padding-h padding-v-5 border-solid border-1 border-bottom'><label class='radio _cursor-poiter _vertical-align-middle'><input name='SuggestLocation' type='radio'/><i><span class='padding-left-5'>Tôi sẽ tự chọn phường xã</span></i></label><li>");a[0].querySelector("input").addEventListener("change",function(e){txtLatitude.value="",txtLongitude.value="",userLocalStorage.VnLocationId="",userLocalStorage.VnLocationName="",userLocalStorage.Latitude=0,userLocalStorage.Longitude=0,LocalStorageHelper.Set(LocalStorageNamesEnum.UserConfigs,userLocalStorage),Site.ClosePopup()}),vnLocationSuggestContainer.appendChild(a[0]),o.forEach(function(e){var t="<li class='row padding-h padding-v-5 border-solid border-1 border-bottom'><label class='radio _cursor-poiter _vertical-align-middle'><input name='SuggestLocation' type='radio' data-lat='"+e.geoLocation.coordinates.latitude+"' data-lng='"+e.geoLocation.coordinates.longitude+"'  data-full-address='"+e.fullAddress+"'  data-level="+e.geoLocation.level+" data-vnlocation-id='"+e.id+"'/><i><span class='padding-left-5'>"+e.fullAddress+"</span></i></label><li>",o=Site.HtmlToElement(t);o[0].querySelector("input").addEventListener("change",function(e){Site.ClosePopup(),userLocalStorage.VnLocationId=e.target.dataset.vnlocationId,userLocalStorage.VnLocationName=e.target.dataset.fullAddress,LocalStorageHelper.Set(LocalStorageNamesEnum.UserConfigs,userLocalStorage),selectedSuggestGeoLocation()}),vnLocationSuggestContainer.appendChild(o[0])}),suggestLocationModel.removeAttribute("hidden"),suggestLocationModel.classList.add("visible"),updateVnLocation()}})},function(e){1==e.code?alert("Bạn đã từ chối chia sẻ vị trí."):2==e.code&&btnLatLng.classList.add("hide")}):btnLatLng&&btnLatLng.classList.add("hide")}function selectedSuggestGeoLocation(){var e,t=null!==(e=LocalStorageHelper.Get(LocalStorageNamesEnum.UserConfigs))&&void 0!==e?e:LocalStorageHelper.InitUserConfigs();txtVnLocationId.value=t.VnLocationId,txtVnLocationName.value=t.VnLocationName,document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked")?selectWarehouse(t.Latitude,t.Longitude):updateVnLocation()}function showAnimation(){}function initPayment(){vnLocationSuggestContainer=document.querySelector("[geo-location-suggest]"),suggestLocationModel=document.getElementById("suggestLocationModel"),showListVoucherModel=document.getElementById("maskBlackListVoucherModel"),txtLatitude=document.getElementById("OrderViewModel_Latitude"),txtLongitude=document.getElementById("OrderViewModel_Longitude"),btnLatLng=document.getElementById("btnGetCurentLatLng"),(btnLoadLazyListVoucher=document.getElementById("btnShowMoreDiscountCode")).addEventListener("click",function(){Site.ClosePopup(),loadListVoucher()}),myList=document.getElementById("mylist"),txtPhone=document.getElementById("OrderViewModel_PhoneNumber"),(txtAddress=document.getElementById("OrderViewModel_Address")).addEventListener("keyup",function(e){updateRealAddress()}),txtId=document.getElementById("OrderViewModel_ShippingAddressId"),txtFullName=document.getElementById("OrderViewModel_FullName"),btnSearchWard=document.getElementById("btnSearchWard"),txtVnLocationName=document.getElementById("OrderViewModel_VnLocationName"),txtVnLocationId=document.getElementById("OrderViewModel_VnLocationId"),txtVnLocationName.addEventListener("keyup",function(e){updateVnLocation(),updateRealAddress()}),txtDiscountCode=document.getElementById("OrderViewModel_DiscountCode"),spanDataShipAddress=document.querySelector("[data-ship-address]"),txtDiscountCode.addEventListener("keyup",function(e){Site.Debounce(uploadCart(e.target.value),2e3)}),btnComplete=document.querySelector("#btnComplete"),listLabelNeedPlaceId=document.querySelectorAll("[data-check-paytype]"),btnShowSugestModel=document.getElementById("btnShowSugestModel")}function processListItemShopingCartcartDetail(){var e=document.getElementById("message");privateNoVnLocationMessage=e.innerText,txtVnLocationId.value&&updateVnLocation(!0)}function loadVoucher(e){e!=(txtCode=document.getElementById("txtCode")).value&&(txtCode.value=e,(btnSubmitLoadDiscountCode=document.getElementById("btnSubmitLoadDiscountCode")).click())}function uploadCart(e){console.log("uploadCart:"+e),loadVoucher(e),(txtDiscountcartDetail=document.getElementById("txtDiscountcartDetail")).value=e,(btnReloadShopingCartcartDetail=document.getElementById("btnReloadShopingCartcartDetail")).click()}function loadCleave(){var e=document.getElementById("OrderViewModel_PhoneNumber");phoneNumberCleave=new Cleave(e,{numericOnly:!0})}function loadAutoComplete(){new Awesomplete("#OrderViewModel_FullName",{filter:function(e,t){return Awesomplete.FILTER_CONTAINS(e,t.match(/[^\|]*$/)[0])},item:function(e,t){return Awesomplete.ITEM(e,t.match(/[^\|]*$/)[0])},replace:function(e){var t=this.input.value.match(/^.+\|\s*|/)[0];this.input.value=t+e.value.split("=")[1]}}),document.getElementById("OrderViewModel_FullName").addEventListener("awesomplete-selectcomplete",function(e){var t=e.text.value.split("=")[0];e.target.value=e.text.value.split("=")[1];for(var o=0;o<myList.options.length;o++){var a=myList.options[o];a.id===t&&(txtPhone.value=a.dataset.phone,txtAddress.value=a.dataset.address,txtId.value=t,console.log("autocomplet"),loadCleave())}}),document.getElementById("OrderViewModel_FullName").addEventListener("change",function(e){console.log("change"),loadCleave()})}function updateRealAddress(){spanDataShipAddress.innerHTML=txtAddress.value?(txtAddress.value+", "+txtVnLocationName.value).trim():txtVnLocationName.value}function loadLocationAutoComplete(){$("#OrderViewModel_VnLocationName").autocomplete({appendTo:"#suggestListLocationContainer",serviceUrl:"/shopingcart/searchlocationcomplete?loadLatLng=True",deferRequestBy:300,minChars:3,noCache:!0,onSelect:function(e){updateRealAddress(e),txtVnLocationId.value=e.data.id,document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked")?selectWarehouse(e.data.latitude,e.data.longitude):updateVnLocation()},triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,noSuggestionNotice:"Không tìm thấy địa chỉ",formatResult:function(e,t){return"<div class='padding-5  _cursor-poiter' data-lat='"+e.data.latitude+"' data-lng='"+e.data.longitude+"'  data level="+e.data.level+" data-vnlocation-id='"+e.data.id+"'>"+e.value+"</div>"},lookupFilter:function(e,t,o){return new RegExp("\\b"+$.Autocomplete.utils.escapeRegExChars(o),"gi").test(e.value)},onSearchStart:function(e){Site.AddClassElement(btnSearchWard,"active"),txtVnLocationId.value=""},onSearchComplete:function(e,t){Site.RemoveClassElement(btnSearchWard,"active")}})}function updateVnLocation(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=txtVnLocationId.value,o=document.querySelector("#frmLazyLoadShopingCartcartDetail [name=vnLocationId]"),a=document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked");if(t){if(t!=o.value||e){t!==userLocalStorage.VnLocationId?(txtLatitude.value="",txtLongitude.value=""):(txtLatitude.value=userLocalStorage.Latitude,txtLongitude.value=userLocalStorage.Longitude),o.value=t;var n=document.querySelector("[data-weight]"),i=document.getElementById("shipPrice");i&&(i.innerText="Loadding...");var d=document.getElementById("suggestMessage");d&&(d.innerText="Loadding..."),AjaxRequest.SendRequestGetJson("POST","shopingcart/getshipfree",{vnLocationId:t,sumdiscount:n.dataset.sumReal,warehouseId:a?a.value:"",totalWeight:n.dataset.weight,dropAddress:txtAddress.value,discountCode:txtDiscountCode.value,latitude:txtLatitude?txtLatitude.value:"",longitude:txtLongitude?txtLongitude.value:"",payTypeEnumStr:document.querySelector("[name='OrderViewModel.PayTypeEnum']:checked").value},function(e,t){var o=JSON.parse(e).sort(function(e,t){return 0<e.shipPrice&&0<t.shipPrice?e.shipPrice===t.shipPrice?t.shipmentTypeEnum-e.shipmentTypeEnum:t.shipPrice-e.shipPrice:e.shipPrice-t.shipPrice});(shipInfoResponses=Array.from(o.reverse()))&&UpdatePriceAndSelectedItem(shipInfoResponses[0].shipmentTypeEnum)})}}else o&&(o.value="")}function UpdateShipmentInfo(t){var e=Array.from(shipInfoResponses).filter(function(e){return e.shipmentTypeEnum==+t})[0];if(e){var o=document.getElementById("message"),a=document.querySelector("[data-more-paytype]"),n=document.getElementById("suggestMessage"),i=document.getElementById("delShipPrice"),d=document.getElementById("shipPrice"),r=document.getElementById("delTotal"),l=document.getElementById("total"),c=document.querySelector("[data-weight]"),u=document.querySelector("[data-user-rpoint]");if(e&&e.vnLocationId){txtVnLocationName.classList.remove("text-warning"),o.classList.add("text-info"),o.classList.remove("text-warning"),a.classList.add("hide");for(var s=0;s<listLabelNeedPlaceId.length;s++){(g=listLabelNeedPlaceId[s]).classList.remove("disabled"),g.querySelector("input").removeAttribute("disabled")}}else{txtVnLocationName.classList.add("text-warning"),o.classList.add("text-warning"),o.classList.remove("text-info"),a.classList.remove("hide");for(s=0;s<listLabelNeedPlaceId.length;s++){var g;"Cod"===(g=listLabelNeedPlaceId[s]).dataset.checkPaytype?g.querySelector("input").dispatchEvent(new Site.CreateEvent("change")):(g.querySelector("input").disabled="disabled",g.classList.add("disabled"))}}o.innerText=e.errorMessage,n.innerText=e.suggestionMessage,i.innerText=WNumbHelper.GetFrNumber(e.shipPrice),i.parentNode.classList.add(e.shipPrice!=0<e.discountShipPrice?"visible":"hidden"),d.innerText=WNumbHelper.GetFrNumber(e.discountShipPrice);var m=+c.dataset.sumReal,L=+c.dataset.sumTemp,p=L+e.shipPrice>e.discountShipPrice+m;if(r.parentNode.classList.add(p?"visible":"hidden"),l.innerText=WNumbHelper.GetFrNumber(e.discountShipPrice+m),r.innerText=WNumbHelper.GetFrNumber(L+e.shipPrice),u){var v=u.dataset.userRpoint;u.innerText=WNumbHelper.GetFrNumber(Math.min(e.discountShipPrice+m,v))+" điểm R-Point"}}}function UpdatePriceAndSelectedItem(e){var t=document.querySelectorAll("[data-list-delivery] label");if(t)for(var o=0;o<t.length;o++){var a=t[o].querySelector("input");a.disabled=!1;var n=Array.from(shipInfoResponses).filter(function(e){return e.shipmentTypeEnum==+a.value})[0];if(n){var i=t[o].querySelector("[data-price]");t[o].querySelector("[data-delivery-option]").innerText=n.deliveryOptionName,0<+n.shipPrice?i.innerText=WNumbHelper.GetFrNumber(n.shipPrice):n.disabled&&(a.disabled=!0,i.innerText=""),+a.value==e&&(a.checked=!0,a.dispatchEvent(new Site.CreateEvent("change")))}}else UpdateShipmentInfo(shipInfoResponses[0].shipmentTypeEnum)}function changeButtonToNextStep(e){btnComplete.innerText=e}function checkLocationValid(e){if(!forceComplete&&!txtVnLocationId.value){var t=document.getElementById("modelMessage");t.innerHTML="Không xác định được: '"+txtVnLocationName.value+"'<br/>";var o=$("#OrderViewModel_VnLocationName").autocomplete().suggestions,a=document.getElementById("modelListLocation");if(a.innerHTML="",o.length){t.innerHTML+="Thay vì NHẬP hãy <strong>CHỌN</strong> đề xuất";for(var n=0;n<o.length;n++){var i=Site.HtmlToElement("<li class='padding _cursor-poiter hover-text-strong' data-location-id='"+o[n].data.id+"'>"+o[n].value+"</li>");i[0].addEventListener("click",function(e){txtVnLocationId.value=e.currentTarget.dataset.locationId,txtVnLocationName.value=e.currentTarget.innerText,updateVnLocation(),Site.ClosePopup()}),a.append(i[0])}}return btnShowSugestModel.click(),void e.abort()}userLocalStorage.OrderPhone=txtPhone.value,userLocalStorage.OrderAddress=txtAddress.value,userLocalStorage.OrderFulName=txtFullName.value,userLocalStorage.VnLocationId!==txtVnLocationId.value&&(userLocalStorage.Latitude=0,userLocalStorage.Longitude=0,userLocalStorage.VnLocationName="",userLocalStorage.VnLocationId=""),LocalStorageHelper.Set(LocalStorageNamesEnum.UserConfigs,userLocalStorage),Site.ShowMaskBlack(1e3,"maskBlackPayment")}function loadFromLocalUserStorange(){var e,t,o,a,n,i,d,r,l,c,u=null!==(e=LocalStorageHelper.Get(LocalStorageNamesEnum.UserConfigs))&&void 0!==e?e:LocalStorageHelper.InitUserConfigs();txtPhone.value=null!==(t=null==u?void 0:u.OrderPhone)&&void 0!==t?t:"",txtAddress.value=null!==(o=null==u?void 0:u.OrderAddress)&&void 0!==o?o:"",txtFullName.value=null!==(a=null==u?void 0:u.OrderFulName)&&void 0!==a?a:"",txtVnLocationName.value=null!==(n=null==u?void 0:u.VnLocationName)&&void 0!==n?n:"",txtVnLocationId.value=null!==(i=null==u?void 0:u.VnLocationId)&&void 0!==i?i:"",txtLatitude.value=null!==(d=null===(r=userLocalStorage)||void 0===r?void 0:r.Latitude)&&void 0!==d?d:0,txtLongitude.value=null!==(l=null===(c=userLocalStorage)||void 0===c?void 0:c.Longitude)&&void 0!==l?l:0}function warehouseSelected(){var e=document.querySelector("#OrderViewModel_SelectedWarehouseId"),t=document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked");e.value=null==t?void 0:t.value,updateVnLocation(!0)}document.addEventListener("DOMContentLoaded",function(){var e;userLocalStorage=null!==(e=LocalStorageHelper.Get(LocalStorageNamesEnum.UserConfigs))&&void 0!==e?e:LocalStorageHelper.InitUserConfigs(),initPayment(),loadCleave(),loadAutoComplete(),loadLocationAutoComplete(),(btnReloadShopingCartcartDetail=document.getElementById("btnReloadShopingCartcartDetail")).click(),updateRealAddress(),processGetLatlongBtn(),(isAuthenticated="True"==!!document.querySelector("[data-authenticated]").dataset.authenticated)||loadFromLocalUserStorange(),document.getElementById("btnSubmitLoadDiscountCode").click()});