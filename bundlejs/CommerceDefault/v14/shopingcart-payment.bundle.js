"use strict";var listCheckWarehouses,btnLazyloadWarehouse;function lazyloadComplete(){listCheckWarehouses=document.querySelectorAll("._id-clistWareHouses [name='SelectedWarehouseId']");for(var e=0;e<listCheckWarehouses.length;e++)listCheckWarehouses[e].addEventListener("change",function(e){warehouseSelected(e.target.value)})}function selectWarehouse(e,t){for(var a=null,n=1e20,o=0;o<listCheckWarehouses.length;o++){var d=distance(e,t,listCheckWarehouses[o].dataset.lat,listCheckWarehouses[o].dataset.lng);d<n&&(a=listCheckWarehouses[o],n=d)}a.checked=!0,a.dispatchEvent(new Site.CreateEvent("change"))}function distance(e,t,a,n){var o=Math.PI/180,d=o*(a-e),i=o*(n-t),l=(e=o*e,a=o*a,Math.sin(d/2)*Math.sin(d/2)+Math.sin(i/2)*Math.sin(i/2)*Math.cos(e)*Math.cos(a));return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}document.addEventListener("DOMContentLoaded",function(){(btnLazyloadWarehouse=document.getElementById("btnReloadListWarehouse")).click()});var myList,txtPhone,txtAddress,txtId,txtFullName,phoneNumberCleave,btnReloadShopingCartcartDetail,txtCode,txtDiscountcartDetail,txtDiscountCode,btnSubmitLoadDiscountCode,frmShipInfo,btnSearchWard,txtVnLocationName,txtVnLocationId,spanDataShipAddress,listLabelNeedPlaceId,btnComplete,btnShowSugestModel,privateNoVnLocationMessage="",forceComplete=!0;function showAnimation(){}function initPayment(){myList=document.getElementById("mylist"),txtPhone=document.getElementById("OrderViewModel_PhoneNumber"),(txtAddress=document.getElementById("OrderViewModel_Address")).addEventListener("keyup",function(e){updateRealAddress()}),txtId=document.getElementById("OrderViewModel_ShippingAddressId"),txtFullName=document.getElementById("OrderViewModel_FullName"),btnSearchWard=document.getElementById("btnSearchWard"),txtVnLocationName=document.getElementById("OrderViewModel_VnLocationName"),txtVnLocationId=document.getElementById("OrderViewModel_VnLocationId"),txtVnLocationName.addEventListener("keyup",function(e){updateVnLocation(),updateRealAddress()}),txtDiscountCode=document.getElementById("OrderViewModel_DiscountCode"),spanDataShipAddress=document.querySelector("[data-ship-address]"),txtDiscountCode.addEventListener("keyup",function(e){uploadCart(e.target.value)}),btnComplete=document.querySelector("#btnComplete"),listLabelNeedPlaceId=document.querySelectorAll("[data-check-paytype]"),btnShowSugestModel=document.getElementById("btnShowSugestModel")}function processListItemShopingCartcartDetail(){var e=document.getElementById("message");privateNoVnLocationMessage=e.innerText,txtVnLocationId.value&&updateVnLocation(!0)}function uploadCart(e){8===e.length&&(txtCode=document.getElementById("txtCode"),txtDiscountcartDetail=document.getElementById("txtDiscountcartDetail"),txtCode.value=e,txtDiscountcartDetail.value=e,(btnReloadShopingCartcartDetail=document.getElementById("btnReloadShopingCartcartDetail")).click(),(btnSubmitLoadDiscountCode=document.getElementById("btnSubmitLoadDiscountCode")).click())}function loadCleave(){var e=document.getElementById("OrderViewModel_PhoneNumber");phoneNumberCleave=new Cleave(e,{numericOnly:!0,delimiters:[" "," "," "],blocks:[4,3,5]})}function loadAutoComplete(){new Awesomplete("#OrderViewModel_FullName",{filter:function(e,t){return Awesomplete.FILTER_CONTAINS(e,t.match(/[^\|]*$/)[0])},item:function(e,t){return Awesomplete.ITEM(e,t.match(/[^\|]*$/)[0])},replace:function(e){var t=this.input.value.match(/^.+\|\s*|/)[0];this.input.value=t+e.value.split("=")[1]}}),document.getElementById("OrderViewModel_FullName").addEventListener("awesomplete-selectcomplete",function(e){var t=e.text.value.split("=")[0];e.target.value=e.text.value.split("=")[1];for(var a=0;a<myList.options.length;a++){var n=myList.options[a];n.id===t&&(txtPhone.value=n.dataset.phone,txtAddress.value=n.dataset.address,txtId.value=t,console.log("autocomplet"),loadCleave())}}),document.getElementById("OrderViewModel_FullName").addEventListener("change",function(e){console.log("change"),loadCleave()})}function updateRealAddress(){spanDataShipAddress.innerHTML=txtAddress.value?(txtAddress.value+", "+txtVnLocationName.value).trim():txtVnLocationName.value}function loadLocationAutoComplete(){$("#OrderViewModel_VnLocationName").autocomplete({appendTo:"#suggestListLocationContainer",serviceUrl:"/shopingcart/searchlocationcomplete?loadLatLng=True",deferRequestBy:300,minChars:3,noCache:!0,onSelect:function(e){updateRealAddress(e),txtVnLocationId.value=e.data.id,document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked")?selectWarehouse(e.data.latitude,e.data.longitude):updateVnLocation()},triggerSelectOnValidInput:!1,showNoSuggestionNotice:!0,noSuggestionNotice:"Không tìm thấy địa chỉ",formatResult:function(e,t){return"<div class='padding-5  _cursor-poiter' data-lat='"+e.data.latitude+"' data-lng='"+e.data.longitude+"'  data level="+e.data.level+" data-vnlocation-id='"+e.data.id+"'>"+e.value+"</div>"},lookupFilter:function(e,t,a){return new RegExp("\\b"+$.Autocomplete.utils.escapeRegExChars(a),"gi").test(e.value)},onSearchStart:function(e){Site.AddClassElement(btnSearchWard,"active"),txtVnLocationId.value=""},onSearchComplete:function(e,t){Site.RemoveClassElement(btnSearchWard,"active")}})}function updateVnLocation(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=txtVnLocationId.value,a=document.querySelector("#frmLazyLoadShopingCartcartDetail [name=vnLocationId]"),n=document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked");if(t){if(t!=a.value||e){a.value=t;var o=document.querySelector("[data-weight]");document.getElementById("shipPrice").innerText="Loadding...",document.getElementById("suggestMessage").innerText="Loadding...",AjaxRequest.SendRequestGetJson("POST","shopingcart/getshipfree",{vnLocationId:t,sumdiscount:o.dataset.sumReal,warehouseId:n?n.value:"",totalWeight:o.dataset.weight},function(e,t){var a=JSON.parse(e);UpdateShipmentInfo(a.vnLocationId,a.message,a.suggestMessage,a.normalShipPrice,a.maxSupportNormalShipPrice,a.shipDiscountPercent)})}}else a&&(a.value=""),UpdateShipmentInfo(null,privateNoVnLocationMessage,"",0,0,0)}function UpdateShipmentInfo(e,t,a,n,o,d){var i=document.getElementById("message"),l=document.querySelector("[data-more-paytype]"),r=document.getElementById("suggestMessage"),c=document.getElementById("delShipPrice"),s=document.getElementById("shipPrice"),u=document.getElementById("delTotal"),m=document.getElementById("total"),h=document.querySelector("[data-weight]"),p=document.querySelector("[data-user-rpoint]");if(e){txtVnLocationName.classList.remove("text-warning"),i.classList.add("text-info"),i.classList.remove("text-warning"),l.classList.add("hide");for(var g=0;g<listLabelNeedPlaceId.length;g++){(v=listLabelNeedPlaceId[g]).classList.remove("disabled"),v.querySelector("input").removeAttribute("disabled")}}else{txtVnLocationName.classList.add("text-warning"),i.classList.add("text-warning"),i.classList.remove("text-info"),l.classList.remove("hide");for(g=0;g<listLabelNeedPlaceId.length;g++){var v;"Cod"===(v=listLabelNeedPlaceId[g]).dataset.checkPaytype?v.querySelector("input").dispatchEvent(new Site.CreateEvent("change")):(v.querySelector("input").disabled="disabled",v.classList.add("disabled"))}}i.innerText=t,r.innerText=a;var L=n-(0===o?n:o)*d/100;c.parentNode.classList.add(0<d?"visible":"hidden"),c.innerText=WNumbHelper.GetFrNumber(n),s.innerText=WNumbHelper.GetFrNumber(L);var S=+h.dataset.sumReal,y=+h.dataset.sumTemp;if(u.parentNode.classList.add(0<d||S!==y?"visible":"hidden"),u.innerText=WNumbHelper.GetFrNumber(n+y),m.innerText=WNumbHelper.GetFrNumber(S+L),p){var x=p.dataset.userRpoint;p.innerText=WNumbHelper.GetFrNumber(Math.min(S+L,x))+" điểm R-Point"}}function changeButtonToNextStep(e){btnComplete.innerText=e}function checkLocationValid(e){if(!forceComplete&&!txtVnLocationId.value){var t=document.getElementById("modelMessage");t.innerHTML="Không xác định được: '"+txtVnLocationName.value+"'<br/>";var a=$("#OrderViewModel_VnLocationName").autocomplete().suggestions,n=document.getElementById("modelListLocation");if(n.innerHTML="",a.length){t.innerHTML+="Thay vì NHẬP hãy <strong>CHỌN</strong> đề xuất";for(var o=0;o<a.length;o++){var d=Site.HtmlToElement("<li class='padding _cursor-poiter hover-text-strong' data-location-id='"+a[o].data.id+"'>"+a[o].value+"</li>");d[0].addEventListener("click",function(e){txtVnLocationId.value=e.currentTarget.dataset.locationId,txtVnLocationName.value=e.currentTarget.innerText,updateVnLocation(),Site.ClosePopup()}),n.append(d[0])}}return btnShowSugestModel.click(),void e.abort()}Site.ShowMaskBlack(1e3,"maskBlackPayment")}function warehouseSelected(){var e=document.querySelector("#OrderViewModel_SelectedWarehouseId"),t=document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked");e.value=null==t?void 0:t.value,updateVnLocation(!0)}document.addEventListener("DOMContentLoaded",function(){initPayment(),loadCleave(),loadAutoComplete(),loadLocationAutoComplete(),(btnReloadShopingCartcartDetail=document.getElementById("btnReloadShopingCartcartDetail")).click(),updateRealAddress()});