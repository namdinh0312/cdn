"use strict";var txtQuantities,txtPrices,orderItemLis,weightElement,incomeDisplayElement,totalSellingMoney,totalIncomeMoney,totalSellingMoneyElement,totalIncomeMoneyElement,tbodyElement,txtOrderPopupId,txtAddress,txtId,txtVnLocationName,txtVnLocationId,txtShipPrice,spanNormalShipPrice,spanDataShipAddress,txtOrderMoney,txtWeight,chkIsFastShip,AjaxRequest={SendFormData:function(e,t,a,r,n){var i=new XMLHttpRequest;i.open(e,t,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onreadystatechange=function(e){try{i.readyState===XMLHttpRequest.DONE&&200<=i.status&&i.status<300&&r(i.responseText,i.status)}catch(e){n&&n(e),console.log(e),alert("There was an error processing your request. Please try again later.",!1)}},i.send(a)},SendRequestGetJson:function(e,t,a,r){var n=new XMLHttpRequest,i=new FormData;for(name in a)i.append(name,a[name]);n.open(e,t,!0),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.onreadystatechange=function(e){try{n.readyState===XMLHttpRequest.DONE&&200<=n.status&&n.status<300&&r(n.responseText,n.status)}catch(e){console.log(e),alert("There was an error processing your request. Please try again later.",!1)}},n.send(i)}};function innitOrderDetail(){tbodyElement=document.querySelector("tbody"),orderItemLis=document.querySelectorAll("[data-order-item]"),weightElement=document.querySelector("[data-weight-display]"),totalSellingMoneyElement=document.querySelector("[data-total-selling-money]"),totalIncomeMoneyElement=document.querySelector("[data-total-income-money]"),txtQuantities=document.querySelectorAll("[data-quantity]"),txtPrices=document.querySelectorAll("[data-price]");for(var e=0;e<txtQuantities.length;e++)txtQuantities[e].addEventListener("change",reloadCartMoney);for(e=0;e<txtPrices.length;e++)txtPrices[e].addEventListener("change",reloadCartMoney);txtOrderPopupId=document.getElementById("orderPopupId")}function reloadShipmentAddress(){var e=document.querySelector("[data-order-shipment-id]");txtOrderPopupId.value=e.dataset.orderShipmentId,document.getElementById("btnShowDeleveryDetailModel").click()}function lazyLoadOrderList(){}function initSearchBar1(){var e="/product/searchproductautocompleteproductclass";userId&&(e="/product/searchproductautocompleteproductclass?userId="+userId),$("#autocomplete1").autocomplete({appendTo:"#suggestListContainer1",serviceUrl:e,deferRequestBy:250,minChars:3,noCache:!0,onSelect:function(e){productClassItemClick(e)},showNoSuggestionNotice:!0,noSuggestionNotice:"Không tìm thấy sản phẩm",formatResult:function(e,t){var a=e.data.quantity;return"<div class='padding-5  _cursor-poiter ' data-classId='"+e.data.Id+"'><div class='inline-block _image-wrap'><img width='40' height='40' src='"+e.data.image+"' /></div><div class='inline "+(0==+a?"text-warning":"")+"' data-product-name>"+e.value+e.data.className+(0===a?"":" ("+a+")")+"</div></div>"},lookupFilter:function(e,t,a){return new RegExp("\\b"+$.Autocomplete.utils.escapeRegExChars(a),"gi").test(e.value)},onSearchStart:function(e){Site.AddClassElement(btnSearchProductName1,"active")},onSearchComplete:function(e,t){Site.RemoveClassElement(btnSearchProductName1,"active")}})}function productClassItemClick(e){for(var t=0;t<listProductClasses.length;t++)if(listProductClasses[t]===e.data.id)return;listProductClasses.push(e.data.id);var a=e.data.oneItemPrice,r=document.createElement("tr");r.setAttribute("data-order-item",""),r.setAttribute("data-discount-percent",e.data.discountPercent),r.className="padding-v-10 border-top border-1 border-solid",r.innerHTML="<td class='text-left padding-left-5'><input class='_hidden' data-product-id='"+e.data.id+"' data-weight='3000'> <img class=' _vertical-align-middle' width='36' src='"+e.data.image+"'> <span class=' _vertical-align-middle'> "+e.value+e.data.className+" </span> </td><td  data-secure data-collaborators-price='"+e.data.collaboratorsPrice+"' class='padding-top-5'>"+WNumbHelper.GetFrNumber(e.data.collaboratorsPrice)+"</td><td class='padding-right'> <input class='_hidden' data-product-class-id name='OrderItemQuantityPrices[0].ProductClassificationId' value='"+e.data.id+"' /> <input type='number' data-quantity name='OrderItemQuantityPrices[0].Quantity' class='-round text-right' step='1' min='0' value='1' max='"+e.data.inWarehouse+"' title='SL' size='74' pattern='[0-9]*'> </td><td class='1'><div class='relative'> <input type='number' data-init-price class='hide' name='OrderItemQuantityPrices[0].Price'  value='"+a+"' ><span class='"+(0<e.data.discountPercent?"":"hide")+"'><del class='text-silver text-12'>@item.Price -"+e.data.discountPercent+"%</del></span><label data-lb-lock class='checkbox'><input type='checkbox' data-price-lock id='chkLock"+e.data.id+"' ><i>Tùy nhập giá</i></label><input type='number'  data-price='"+JSON.stringify(e.data.tuplePrices)+"' name='OrderItemQuantityPrices[0].OrderItemPrice' class='inline-block float-right _max-width-100 -round text-right' step='100' min='0' value='"+a+a+"' pattern='[0-9]*'></div> </td><td class='padding-right-20 text-right'> <div class='text-strong'> <span data-money>0</span> <sup>đ</sup> </div></td><td  data-secure class='padding-right-20 text-right'> <div class='text-strong'> <span data-income>0</span> <sup>đ</sup> </div></td>",tbodyElement.appendChild(r),reloadOrder(),innitOrderDetail(),reloadCartMoney()}function reloadOrder(){for(var e=document.querySelectorAll("[data-order-item]"),t=0;t<e.length;t++){var a=e[t].querySelector("[data-product-class-id]"),r=e[t].querySelector("[data-order-id]"),n=e[t].querySelector("[data-quantity]"),i=e[t].querySelector("[data-price]"),o=e[t].querySelector("[data-init-price]");a.name="OrderItemQuantityPrices["+t+"].ProductClassificationId",r&&(r.name="OrderItemQuantityPrices["+t+"].OrderItemId"),n.name="OrderItemQuantityPrices["+t+"].Quantity",i.name="OrderItemQuantityPrices["+t+"].OrderItemPrice",o.name="OrderItemQuantityPrices["+t+"].Price"}}function clearTable(){tbodyElement.innerHTML="",listProductClasses=[]}function updateQuantity(e){var t=e.parentNode.parentNode.querySelector("[data-warehouse-quantity]"),a=+e.querySelector("[data-quantity]").value;t.innerHTML=+t.innerHTML+a}function reloadCartMoney(){for(var e=0,t=0,a=0,r=0;r<orderItemLis.length;r++){incomeDisplayElement=orderItemLis[r].querySelector("[data-income]");var n=orderItemLis[r].querySelector("[data-money]"),i=orderItemLis[r].querySelector("[data-weight]").dataset.weight,o=orderItemLis[r].querySelector("[data-quantity]").value;e+=+o*+i,weightElement.innerHTML=WNumbHelper.GetFrNumber(e);var d=document.querySelector("#frmShipInfo #Weight");d&&(d.value=e);var s=orderItemLis[r].querySelector("[data-collaborators-price]").dataset.collaboratorsPrice*o,c=getUnitPrice(JSON.parse(orderItemLis[r].querySelector("[data-price]").dataset.price),o),l=orderItemLis[r].dataset.discountPercent;orderItemLis[r].querySelector("[data-init-price]").value=c,orderItemLis[r].querySelector("[data-price-lock]").checked||(orderItemLis[r].querySelector("[data-price]").value=c-l*c/100);var u=o*+orderItemLis[r].querySelector("[data-price]").value;n.innerHTML=WNumbHelper.GetFrNumber(u),incomeDisplayElement.innerHTML=WNumbHelper.GetFrNumber(u-s),t+=u,a+=u-s}totalSellingMoneyElement.innerHTML=WNumbHelper.GetFrNumber(t),totalIncomeMoneyElement.innerHTML=WNumbHelper.GetFrNumber(a)}function getUnitPrice(e,t){for(var a=e[e.length-1].money,r=e.length-1;0<=r&&!(0!==e[r].quantity&&+t>=e[r].quantity);r--)a=e[r].money;return a}function initViewComponent(){(txtAddress=document.getElementById("Address"))&&(txtAddress.addEventListener("keyup",function(e){updateRealAddress()}),txtId=document.getElementById("ShippingAddressId"),txtOrderMoney=document.getElementById("OrderMoney"),(txtWeight=document.getElementById("Weight")).addEventListener("change",function(e){updateVnLocation(!0)}),chkIsFastShip=document.getElementById("IsFastShip"),txtVnLocationName=document.getElementById("VnLocationName"),txtVnLocationId=document.getElementById("VnLocationId"),txtShipPrice=document.getElementById("ShipPrice"),spanNormalShipPrice=document.getElementById("spanNormalShipPrice"),Site.BindingAjaxForm("#frmShipInfo"),txtVnLocationName.addEventListener("keyup",function(e){updateVnLocation(),updateRealAddress()}),spanDataShipAddress=document.querySelector("[data-ship-address]"),loadLocationAutoComplete(),updateRealAddress())}function updateRealAddress(){spanDataShipAddress.innerHTML=txtAddress.value?(txtAddress.value+", "+txtVnLocationName.value).trim():txtVnLocationName.value}function loadLocationAutoComplete(){$("#VnLocationName").autocomplete({appendTo:"#suggestListLocationContainer",serviceUrl:"/shopingcart/searchlocationcomplete",deferRequestBy:100,minChars:3,noCache:!0,onSelect:function(e){updateRealAddress(e),txtVnLocationId.value=e.data.id,updateVnLocation()},showNoSuggestionNotice:!0,noSuggestionNotice:"Không tìm thấy địa chỉ",formatResult:function(e,t){return"<div class='padding-5  _cursor-poiter' level="+e.data.level+" data-vnlocation-id='"+e.data.id+"'>"+e.value+"</div>"},lookupFilter:function(e,t,a){return new RegExp("\\b"+$.Autocomplete.utils.escapeRegExChars(a),"gi").test(e.value)},onSearchStart:function(e){txtVnLocationId.value=""},onSearchComplete:function(e,t){}})}function updateVnLocation(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=txtVnLocationId.value,a=document.querySelector("[name=CurentVnLocationId]");t?(e||t!=a.value)&&(a.value=t,AjaxRequest.SendRequestGetJson("POST","/shopingcart/getshipfree",{vnLocationId:t,sumdiscount:txtOrderMoney.value,totalWeight:txtWeight.value,isFast:chkIsFastShip.checked?"True":"False"},function(e,t){var a=JSON.parse(e),r=chkIsFastShip.checked?a.fastShipPrice:a.normalShipPrice,n=chkIsFastShip.checked?a.fastShipPrice-(0===a.maxSupportFastShipPrice?a.fastShipPrice:a.maxSupportFastShipPrice)*a.shipDiscountPercent/100:a.normalShipPrice-(0===a.maxSupportNormalShipPrice?a.normalShipPrice:a.maxSupportNormalShipPrice)*a.shipDiscountPercent/100;txtShipPrice.value=n,spanNormalShipPrice.innerText=WNumbHelper.GetPrice(r,!1)})):txtVnLocationId.value=""}document.addEventListener("DOMContentLoaded",function(){innitOrderDetail(),reloadCartMoney(),initSearchBar1(),reloadShipmentAddress()});