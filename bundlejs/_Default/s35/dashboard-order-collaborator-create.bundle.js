"use strict";var txtQuantities,txtPrices,orderItemLis,weightElement,incomeDisplayElement,totalSellingMoney,totalIncomeMoney,totalSellingMoneyElement,totalIncomeMoneyElement,tbodyElement,txtOrderPopupId,txtAddress,txtId,txtVnLocationName,txtVnLocationId,txtShipPrice,spanNormalShipPrice,spanDataShipAddress,txtOrderMoney,txtWeight,chkIsFastShip,cacheDropVnLocationId,AjaxRequest={SendFormData:function(e,t,a,n,i){var r=new XMLHttpRequest;r.open(e,t,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.onreadystatechange=function(e){try{r.readyState===XMLHttpRequest.DONE&&200<=r.status&&r.status<300&&n(r.responseText,r.status)}catch(e){i&&i(e),console.log(e),alert("There was an error processing your request. Please try again later.",!1)}},r.send(a)},SendRequestGetJson:function(e,t,a,n){var i=new XMLHttpRequest,r=new FormData;for(name in a)r.append(name,a[name]);i.open(e,t,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onreadystatechange=function(e){try{i.readyState===XMLHttpRequest.DONE&&200<=i.status&&i.status<300&&n(i.responseText,i.status)}catch(e){console.log(e),alert("There was an error processing your request. Please try again later.",!1)}},i.send(r)}};function FileUpload(){this.InputElement=null,this.PreviewBoxElement=null,this.CurentImageBox=null,this.Form=null,this.MaxFile=null,this.StoredFiles=[],this.CurentFiles=[],this.CurentPreviewImages=[],this.Extend=function(e,t,a,n,i,r,o,l,s,d,c,u){this.InputElement=n,this.AcceptExtention=n.accept.split(","),this.PreviewBoxElement=r,this.CurentImageBox=i,this.Form=o,this.UniqueControlName=c?"CurentFilePaths":"NewFiles"+c,this.MaxFile=l||2,this.MaxFileSize=u||5242880,this.InputChangeCallBack=void 0!==s?s:null,this.InputElement.addEventListener("change",this.InputChange),(this.InputElement.fileUpload=this).FileReader=new FileReader,this.IsCreateInputName=d||!1,this.HostCdn=e||"",this.CurentFiles=t||[],this.CurentPreviewImages=a||[],this.Process()},this.Process=function(){if(this.CurentImageBox)for(var t=this,e=0;e<this.CurentFiles.length;e++){var a=this.CurentFiles[e],n=this.CurentPreviewImages[e],i=document.createElement("div");i.className="col-3 gutter-10 _p-item text-center";var r=document.createElement("figure");r.className="_max-height-200 relative hover-children-show";var o=document.createElement("button");o.className="absolute hide tablet-show -border width-100 height-100 _fill-silver-opacity text-strong",o.innerText="CLICK ĐỂ XÓA",o.type="button",o.dataset.file=a,o.dataset.notClose="I",o.addEventListener("click",function(e){t.RemoveCurentFile(e,t.InputElement)});var l,s,d=a.substring(a.lastIndexOf("/")+1),c=d.substring(d.indexOf(".")+1);if(("."+c).match(".jpg,.png,.svg,.gif,.jfif,.webp,.csv".replace(new RegExp(",","g"),"|"))?l="<img class='_max-width-100-percent'   onerror='this.src=\"/images/shared/no-image.svg\"'   src='"+t.HostS3+"/"+n+"' alt='"+d+"' data-file='"+d+"' /><figcaption class='padding-5 text-center _text-ellipsis'>"+d+"</figcaption>":(l="<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' version='1'><path d='M128 0c-18 0-32 14-32 32v448c0 18 14 32 32 32h320c18 0 32-14 32-32V128L352 0H128z' fill='#e2e5e7'/><path d='M384 128h96L352 0v96c0 18 14 32 32 32z' fill='#b0b7bd'/><path fill='#cad1d8' d='M480 224l-96-96h96z'/><path d='M416 416c0 9-7 16-16 16H48c-9 0-16-7-16-16V256c0-9 7-16 16-16h352c9 0 16 7 16 16v160z' fill='#f15642'/><path d='M400 432H96v16h304c9 0 16-7 16-16v-16c0 9-7 16-16 16z' fill='#cad1d8'/><text y='375' x='212' style='line-height:1.25;text-align:center' font-weight='400' font-size='147' font-family='sans-serif' letter-spacing='0' word-spacing='0' text-anchor='middle' stroke-width='3'><tspan style='line-height:1.25;-inkscape-font-specification:'monospace Bold';text-align:center' y='375' x='212' font-weight='700' font-family='monospace' fill='#fff'>"+c+"</tspan></text></svg>",(s=document.createElement("div")).innerHTML="<div class='row text-center _text-ellipsis'><a target='_blank' href='"+t.HostCdn+"/"+n+"'>"+d+"</a></div>"),t.IsCreateInputName)l+="<input type='text' class='_hidden'    name='"+t.UniqueControlName+"' value="+a+(t.Form?" form='"+t.Form.id+"'":"")+"></input>";r.innerHTML=l,r.insertBefore(o,r.childNodes[0]),i.appendChild(r),s&&i.appendChild(s),t.CurentImageBox.appendChild(i)}},this.InputChange=function(e){var o=e.target.fileUpload,t=e.target.files,a=Array.prototype.slice.call(t);o.PreviewBoxElement.innerHTML="",o.StoredFiles=[];for(var n=0;n<a.length;n++){var i=a[n];if(i.size>o.MaxFileSize)Site.NotifyFormFailed("Lỗi","File không được lớn hơn "+o.MaxFileSize/1048576+" mb");else if(o.StoredFiles.push(i),o.PreviewBoxElement===o.CurentImageBox&&(o.CurentFiles=[],o.CurentImageBox.innerHTML=""),o.StoredFiles.length+o.CurentFiles.length<=o.MaxFile){var r=new FileReader;r.onload=function(e){var t=event.target,a=document.createElement("div");a.className="gutter-10 _p-item";var n=document.createElement("figure");n.className="_max-height-200 relative hover-children-show";var i,r=document.createElement("button");(r.className="absolute hide -border width-100 height-100 _fill-silver-opacity text-strong",r.type="button",r.innerText="CLICK ĐỂ XÓA",r.dataset.file=t.name,r.dataset.notClose="I",r.addEventListener("click",function(e){o.RemoveFile(e,o.InputElement)}),t.fileType.match("image.*"))?i="<img class='width-100 _max-width-100-percent' src='"+e.target.result+"' alt='"+t.name+"' data-file='"+t.name+"' /><figcaption class='padding-5 text-center _text-ellipsis'>("+t.size%1e3+" kb) "+t.name+"</figcaption>":i="<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 512 512' version='1'><path d='M128 0c-18 0-32 14-32 32v448c0 18 14 32 32 32h320c18 0 32-14 32-32V128L352 0H128z' fill='#e2e5e7'/><path d='M384 128h96L352 0v96c0 18 14 32 32 32z' fill='#b0b7bd'/><path fill='#cad1d8' d='M480 224l-96-96h96z'/><path d='M416 416c0 9-7 16-16 16H48c-9 0-16-7-16-16V256c0-9 7-16 16-16h352c9 0 16 7 16 16v160z' fill='#f15642'/><path d='M400 432H96v16h304c9 0 16-7 16-16v-16c0 9-7 16-16 16z' fill='#cad1d8'/><text y='375' x='212' style='line-height:1.25;text-align:center' font-weight='400' font-size='147' font-family='sans-serif' letter-spacing='0' word-spacing='0' text-anchor='middle' stroke-width='3'><tspan style='line-height:1.25;-inkscape-font-specification:'monospace Bold';text-align:center' y='375' x='212' font-weight='700' font-family='monospace' fill='#fff'>"+t.name.substring(t.name.indexOf(".")+1)+"</tspan></text></svg><figcaption class='padding-5 text-center _text-ellipsis'>("+t.size%1e3+" kb) "+t.name+"</figcaption>";o.IsCreateInputName&&(i+="<input type='text' class='_hidden' name='"+o.UniqueControlName+"[]' value="+t.name+(o.Form?" form='"+o.Form.id+"'":"")+"></input>");n.innerHTML=i,n.insertBefore(r,n.childNodes[0]),a.appendChild(n),o.PreviewBoxElement.appendChild(a)},r.size=i.size,r.fileType=i.type,r.name=i.name,r.readAsDataURL(i)}}o.InputChangeCallBack&&o.InputChangeCallBack(o.StoredFiles)},this.RemoveCurentFile=function(e){for(var t=e.target.dataset.file,a=0;a<this.CurentFiles.length;a++)if(this.CurentFiles[a]===t){this.CurentFiles.splice(a,1);break}Site.FindParent(e.target,"_p-item").remove()},this.RemoveFile=function(e,t){for(var a=e.target.dataset.file,n=0;n<this.StoredFiles.length;n++)if(this.StoredFiles[n].name===a){this.StoredFiles.splice(n,1);break}Site.FindParent(e.target,"_p-item").remove(),Site.ClearInputFile(t)},this.Init=function(e,t,a,n,i,r,o,l,s,d,c,u){var m=document.querySelector(n),p=document.querySelector(r),h=document.querySelector(i),g=document.querySelector(o);null!=m&&null!=p||console.warn(n+" or "+p+": NULL"),this.Extend(e,t,a,m,h,p,g,l,s,d,c,u)}}function innitOrderDetail(){tbodyElement=document.querySelector("tbody"),orderItemLis=document.querySelectorAll("[data-order-item]"),weightElement=document.querySelector("[data-weight-display]"),totalSellingMoneyElement=document.querySelector("[data-total-selling-money]"),totalIncomeMoneyElement=document.querySelector("[data-total-income-money]"),txtQuantities=document.querySelectorAll("[data-quantity]"),txtPrices=document.querySelectorAll("[data-price]");for(var e=0;e<txtQuantities.length;e++)txtQuantities[e].addEventListener("change",reloadCartMoney);for(e=0;e<txtPrices.length;e++)txtPrices[e].addEventListener("change",reloadCartMoney);txtOrderPopupId=document.getElementById("orderPopupId")}function reloadShipmentAddress(){var e=document.querySelector("[data-order-shipment-id]");txtOrderPopupId.value=e.dataset.orderShipmentId,document.getElementById("btnShowDeleveryDetailModel").click()}function lazyLoadOrderList(){}function initSearchBar1(){var e="/product/searchproductautocompleteproductclass";userId&&(e="/product/searchproductautocompleteproductclass?userId="+userId),$("#autocomplete1").autocomplete({appendTo:"#suggestListContainer1",serviceUrl:e,deferRequestBy:250,minChars:3,noCache:!0,onSelect:function(e){productClassItemClick(e)},showNoSuggestionNotice:!0,noSuggestionNotice:"Không tìm thấy sản phẩm",formatResult:function(e,t){var a=e.data.quantity;return"<div class='padding-5  _cursor-poiter ' data-classId='"+e.data.Id+"'><div class='inline-block _image-wrap'><img width='40' height='40' src='"+e.data.image+"' /></div><div class='inline "+(0==+a?"text-warning":"")+"' data-product-name>"+e.value+e.data.className+(0===a?"":" ("+a+")")+"</div></div>"},lookupFilter:function(e,t,a){return new RegExp("\\b"+$.Autocomplete.utils.escapeRegExChars(a),"gi").test(e.value)},onSearchStart:function(e){Site.AddClassElement(btnSearchProductName1,"active")},onSearchComplete:function(e,t){Site.RemoveClassElement(btnSearchProductName1,"active")}})}function productClassItemClick(e){for(var t=0;t<listProductClasses.length;t++)if(listProductClasses[t]===e.data.id)return;listProductClasses.push(e.data.id);var a=e.data.oneItemPrice,n=document.createElement("tr");n.setAttribute("data-order-item",""),n.setAttribute("data-discount-percent",e.data.discountPercent),n.className="padding-v-10 border-top border-1 border-solid",n.innerHTML="<td class='text-left padding-left-5'><input class='_hidden' data-product-id='"+e.data.id+"' data-weight='3000'> <img class=' _vertical-align-middle' width='36' src='"+e.data.image+"'> <span class=' _vertical-align-middle'> "+e.value+e.data.className+" </span> </td><td  data-secure data-collaborators-price='"+e.data.collaboratorsPrice+"' class='padding-top-5'>"+WNumbHelper.GetFrNumber(e.data.collaboratorsPrice)+"</td><td class='padding-right'> <input class='_hidden' data-product-class-id name='OrderItemQuantityPrices[0].ProductClassificationId' value='"+e.data.id+"' /> <input type='number' data-quantity name='OrderItemQuantityPrices[0].Quantity' class='-round text-right' step='1' min='0' value='1' max='"+e.data.inWarehouse+"' title='SL' size='74' pattern='[0-9]*'> </td><td class='1'><div class='relative'> <input type='number' data-init-price class='hide' name='OrderItemQuantityPrices[0].Price'  value='"+a+"' ><span class='"+(0<e.data.discountPercent?"":"hide")+"'><del class='text-silver text-12'>@item.Price -"+e.data.discountPercent+"%</del></span><label data-lb-lock class='checkbox'><input type='checkbox' data-price-lock id='chkLock"+e.data.id+"' ><i>Tùy nhập giá</i></label><input type='number'  data-price='"+JSON.stringify(e.data.tuplePrices)+"' name='OrderItemQuantityPrices[0].OrderItemPrice' class='inline-block float-right _max-width-100 -round text-right' step='100' min='0' value='"+a+a+"' pattern='[0-9]*'></div> </td><td class='padding-right-20 text-right'> <div class='text-strong'> <span data-money>0</span> <sup>đ</sup> </div></td><td  data-secure class='padding-right-20 text-right'> <div class='text-strong'> <span data-income>0</span> <sup>đ</sup> </div></td>",tbodyElement.appendChild(n),reloadOrder(),innitOrderDetail(),reloadCartMoney()}function reloadOrder(){for(var e=document.querySelectorAll("[data-order-item]"),t=0;t<e.length;t++){var a=e[t].querySelector("[data-product-class-id]"),n=e[t].querySelector("[data-order-id]"),i=e[t].querySelector("[data-quantity]"),r=e[t].querySelector("[data-price]"),o=e[t].querySelector("[data-init-price]");a.name="OrderItemQuantityPrices["+t+"].ProductClassificationId",n&&(n.name="OrderItemQuantityPrices["+t+"].OrderItemId"),i.name="OrderItemQuantityPrices["+t+"].Quantity",r.name="OrderItemQuantityPrices["+t+"].OrderItemPrice",o.name="OrderItemQuantityPrices["+t+"].Price"}}function clearTable(){tbodyElement.innerHTML="",listProductClasses=[]}function updateQuantity(e){var t=e.parentNode.parentNode.querySelector("[data-warehouse-quantity]"),a=+e.querySelector("[data-quantity]").value;t.innerHTML=+t.innerHTML+a}function reloadCartMoney(){for(var e=0,t=0,a=0,n=0;n<orderItemLis.length;n++){incomeDisplayElement=orderItemLis[n].querySelector("[data-income]");var i=orderItemLis[n].querySelector("[data-money]"),r=orderItemLis[n].querySelector("[data-weight]").dataset.weight,o=orderItemLis[n].querySelector("[data-quantity]").value;e+=+o*+r,weightElement.innerHTML=WNumbHelper.GetFrNumber(e);var l=document.querySelector("#frmShipInfo #Weight");l&&(l.value=e);var s=orderItemLis[n].querySelector("[data-collaborators-price]").dataset.collaboratorsPrice*o,d=getUnitPrice(JSON.parse(orderItemLis[n].querySelector("[data-price]").dataset.price),o),c=orderItemLis[n].dataset.discountPercent;orderItemLis[n].querySelector("[data-init-price]").value=d,orderItemLis[n].querySelector("[data-price-lock]").checked||(orderItemLis[n].querySelector("[data-price]").value=d-c*d/100);var u=o*+orderItemLis[n].querySelector("[data-price]").value;i.innerHTML=WNumbHelper.GetFrNumber(u),incomeDisplayElement.innerHTML=WNumbHelper.GetFrNumber(u-s),t+=u,a+=u-s}totalSellingMoneyElement.innerHTML=WNumbHelper.GetFrNumber(t),totalSellingMoneyElement.dataset.money=t,totalIncomeMoneyElement.innerHTML=WNumbHelper.GetFrNumber(a),loadRPoint()}function getUnitPrice(e,t){for(var a=e[e.length-1].money,n=e.length-1;0<=n&&!(0!==e[n].quantity&&+t>=e[n].quantity);n--)a=e[n].money;return a}function innitFileUpload(){var e=document.getElementById("inputCollaboratorOrderExist"),t=e.dataset.curentPathFiles&&""!==e.dataset.curentPathFiles?[e.dataset.curentPathFiles]:null,a=e.dataset.curentShowingImages&&""!==e.dataset.curentShowingImages?[e.dataset.curentShowingImages]:null,n=e.dataset.maxSize?+e.dataset.maxSize:5242880;(new FileUpload).Init(e.dataset.host,t,a,"#inputCollaboratorOrderExist","#newReviewContainer","#newReviewContainer","#frmUpdateOrder",1,console.log("change"),!0,"CollaboratorOrderExist",n)}function processItemPrice(e){if(e.checked)for(var t=document.querySelectorAll("#_id-order-item-container input[data-price]"),a=0;a<t.length;a++)t[a].value=0,t[a].readOnly=!0;else{var n=document.querySelectorAll("#_id-order-item-container [data-order-item]");for(a=0;a<n.length;a++){var i=n[a];i.querySelector("[data-price-lock]").checked=!1,i.querySelector("[data-price]").readOnly=!1,i.querySelector("input[data-quantity]").dispatchEvent(new Site.CreateEvent("change")),i.querySelector("[data-price-lock]").checked=!0}}reloadCartMoney()}function loadRPoint(){if(totalSellingMoneyElement){var e=+totalSellingMoneyElement.dataset.money;if(txtShipPrice){var t=+txtShipPrice.value,a=document.querySelector("[data-user-rpoint]");if(a){var n=a.dataset.userRpoint;a.innerText=WNumbHelper.GetFrNumber(Math.min(e+t,n))+" điểm R-Point"}}}}document.addEventListener("DOMContentLoaded",function(){innitOrderDetail(),reloadCartMoney(),initSearchBar1(),reloadShipmentAddress(),innitFileUpload()});var shipInfoResponses=null;function initViewComponent(){(txtAddress=document.getElementById("Address"))&&(txtAddress.addEventListener("keyup",function(e){updateRealAddress()}),txtId=document.getElementById("ShippingAddressId"),txtOrderMoney=document.getElementById("OrderMoney"),(txtWeight=document.getElementById("Weight")).addEventListener("change",function(e){updateVnLocation(!0)}),chkIsFastShip=document.getElementById("IsFastShip"),txtVnLocationName=document.getElementById("VnLocationName"),txtVnLocationId=document.getElementById("VnLocationId"),txtShipPrice=document.getElementById("ShipPrice"),spanNormalShipPrice=document.getElementById("spanNormalShipPrice"),Site.BindingAjaxForm("#frmShipInfo"),txtVnLocationName.addEventListener("keyup",function(e){updateVnLocation(),updateRealAddress()}),spanDataShipAddress=document.querySelector("[data-ship-address]"),loadLocationAutoComplete(),updateVnLocation(!0),updateRealAddress())}function updateRealAddress(){spanDataShipAddress.innerHTML=txtAddress.value?(txtAddress.value+", "+txtVnLocationName.value).trim():txtVnLocationName.value}function loadLocationAutoComplete(){$("#VnLocationName").autocomplete({appendTo:"#suggestListLocationContainer",serviceUrl:"/shopingcart/searchlocationcomplete",deferRequestBy:100,minChars:3,noCache:!0,onSelect:function(e){updateRealAddress(e),txtVnLocationId.value=e.data.id,updateVnLocation()},showNoSuggestionNotice:!0,noSuggestionNotice:"Không tìm thấy địa chỉ",formatResult:function(e,t){return"<div class='padding-5  _cursor-poiter' level="+e.data.level+" data-vnlocation-id='"+e.data.id+"'>"+e.value+"</div>"},lookupFilter:function(e,t,a){return new RegExp("\\b"+$.Autocomplete.utils.escapeRegExChars(a),"gi").test(e.value)},onSearchStart:function(e){txtVnLocationId.value=""},onSearchComplete:function(e,t){}})}function updateVnLocation(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=txtVnLocationId.value,a=document.querySelector("#frmShipInfo [name=VnLocationId]"),n=document.querySelector("[data-warehouse-list-container] [name='SelectedWarehouseId']:checked");if(t){if(t!=cacheDropVnLocationId||e){a.value=t;var i=document.querySelector("[data-weight]");spanNormalShipPrice.innerText="Loadding...",AjaxRequest.SendRequestGetJson("POST","shopingcart/getshipfree",{vnLocationId:t,sumdiscount:i.dataset.sumReal,warehouseId:n?n.value:"",totalWeight:i.dataset.weight},function(e,t){var a=JSON.parse(e);cacheDropVnLocationId=txtVnLocationId.value;var n=a.sort(function(e,t){return 0<e.normalShipPrice&&0<t.normalShipPrice?t.normalShipPrice-e.normalShipPrice:e.normalShipPrice-t.normalShipPrice});(shipInfoResponses=Array.from(n.reverse()))&&UpdatePriceAndSelectedItem(shipInfoResponses[0].shipmentTypeEnum)})}}else a&&(a.value="")}function UpdatePriceAndSelectedItem(e){for(var t=document.querySelectorAll("[data-list-delivery] label"),a=0;a<t.length;a++){var n=t[a].querySelector("input"),i=shipInfoResponses.filter(function(e){return e.shipmentTypeEnum==+n.value})[0];if(i){if(0<+i.normalShipPrice)t[a].querySelector("[data-price]").innerText=WNumbHelper.GetFrNumber(i.normalShipPrice)+" - "+WNumbHelper.GetFrNumber(i.fastShipPrice);+n.value==e&&(n.checked=!0,n.dispatchEvent(new Site.CreateEvent("change")),i.normalShipPrice==i.fastShipPrice&&(chkIsFastShip.checked=!0),spanNormalShipPrice.innerText=chkIsFastShip.checked?WNumbHelper.GetFrNumber(i.fastShipPrice):WNumbHelper.GetFrNumber(i.normalShipPrice),txtShipPrice.value=chkIsFastShip.checked?i.fastShipPrice:i.normalShipPrice)}}}